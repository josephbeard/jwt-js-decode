function __awaiter(t,r,e,n){return new(e||(e=Promise))(function(i,o){function a(t){try{s(n.next(t))}catch(t){o(t)}}function u(t){try{s(n.throw(t))}catch(t){o(t)}}function s(t){t.done?i(t.value):new e(function(r){r(t.value)}).then(a,u)}s((n=n.apply(t,r||[])).next())})}function __generator(t,r){function e(t){return function(r){return n([t,r])}}function n(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(t,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var i,o,a,u,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u}function s2J(t){try{return JSON.parse(t)}catch(t){throw new Error(ILLEGAL_ARGUMENT)}}function b2s(t){try{if("object"==typeof window&&"function"==typeof window.atob)return window.atob(t);if("undefined"!=typeof Buffer)return Buffer.from(t,"base64").toString("binary");throw new Error(ILLEGAL_ARGUMENT)}catch(t){throw new Error(t)}}function b2bu(t){if("string"!=typeof t||t.length%4!=0)throw new Error(ILLEGAL_ARGUMENT);return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function bu2b(t){if("string"!=typeof t||t.length%4==1)throw new Error(ILLEGAL_ARGUMENT);for(;t.length%4!=0;)t+="=";return t.replace(/\-/g,"+").replace(/_/g,"/")}function bu2s(t){return b2s(bu2b(t))}function isGzip(t){return"object"==typeof t&&"string"==typeof t.zip&&"GZIP"===t.zip.toUpperCase()}function jwtDecode(t){return new JwtDecode(t)}function jwtSplit(t){return new JwtSplit(t)}function s2b(t){try{if("object"==typeof window&&"function"==typeof window.atob)return window.btoa(t);if("undefined"!=typeof Buffer)return Buffer.from(t).toString("base64");throw new Error(ILLEGAL_ARGUMENT)}catch(t){throw new Error(t)}}function s2bu(t){return b2bu(s2b(t))}function s2zbu(t){return s2bu(zip(t))}function unzip(t){if("string"!=typeof t)throw new Error(ILLEGAL_ARGUMENT);return pako.inflate(t,{raw:!1,from:"string",to:"string"})}function zbu2s(t){return unzip(bu2s(t))}function zip(t){if("string"!=typeof t)throw new Error(ILLEGAL_ARGUMENT);return pako.deflate(t,{raw:!1,from:"string",to:"string"})}function s2AB(t){for(var r=new Uint8Array(t.length),e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}function AB2s(t){return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),String.fromCharCode.apply(String,t)}function createHmac(t,r){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return webCryptoSubtle?(e=s2AB(r),[4,webCryptoSubtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!0,["sign"]).then(function(t){return{_key:t,update:function(r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,webCryptoSubtle.sign("HMAC",t,s2AB(r))];case 1:return[2,e.sent()]}})})}}})]):[3,2];case 1:return[2,n.sent()];case 2:return[2,crypto&&crypto.createHmac?Promise.resolve(crypto.createHmac(t.replace("SHA-","sha"),r)):Promise.reject(webCrypto)]}})})}function algHSsign(t){return function(r,e){return __awaiter(this,void 0,void 0,function(){var n,i,o,a,u,s,c;return __generator(this,function(f){switch(f.label){case 0:return[4,createHmac("SHA-"+t,e)];case 1:return n=f.sent(),o=(i=Promise).resolve,webCryptoSubtle?(u=s2bu,s=AB2s,c=n,c?[4,n.update(r)]:[3,3]):[3,4];case 2:c=f.sent(),f.label=3;case 3:return a=u.apply(void 0,[s.apply(void 0,[c])]),[3,5];case 4:a=b2bu(n&&n.update(r).digest("base64")),f.label=5;case 5:return[2,o.apply(i,[a])]}})})}}function algHSverify(t){return function(r,e,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,algHSsign(t)(r,n)];case 1:return[2,i.sent()===e]}})})}}function RS2AB(t){if("string"!=typeof t)throw new Error(ILLEGAL_ARGUMENT);var r=["-BEGIN RSA PRIVATE KEY-","-BEGIN RSA PUBLIC KEY-","-BEGIN PUBLIC KEY-","-END PUBLIC KEY-","-END RSA PRIVATE KEY-","-END RSA PUBLIC KEY-"],e=t.split("\n").map(function(t){return t.trim()}).filter(function(t){return t.length&&!r.some(function(r){return t.toUpperCase().indexOf(r)>-1})}).join("");if(e.length)return s2AB(e);throw new Error(ILLEGAL_ARGUMENT)}function algVerify(t,r,e,n){return __awaiter(this,void 0,void 0,function(){var i,o,a,u;return __generator(this,function(s){switch(s.label){case 0:if("string"!=typeof t||t.length<4)throw new Error(UNSUPPORTED_ALGORITHM);if("none"===(i=t.toLowerCase()))return[2,""===e];if(o=i.slice(0,2),a=parseInt(i.slice(2)),isNaN(a)||[256,384,512].indexOf(a)<0)throw new Error(UNSUPPORTED_ALGORITHM);switch(u=o){case"hs":return[3,1]}return[3,3];case 1:return[4,algHSverify(a)(r,e,n)];case 2:return[2,s.sent()];case 3:throw new Error(UNSUPPORTED_ALGORITHM)}})})}function algSign(t,r,e){return __awaiter(this,void 0,void 0,function(){var n,i,o,a;return __generator(this,function(u){switch(u.label){case 0:if("string"!=typeof t||t.length<4)throw new Error(UNSUPPORTED_ALGORITHM);if("none"===(n=t.toLowerCase()))return[2,""];if(i=n.slice(0,2),o=parseInt(n.slice(2)),isNaN(o)||[256,384,512].indexOf(o)<0)throw new Error(UNSUPPORTED_ALGORITHM);switch(a=i){case"hs":return[3,1]}return[3,3];case 1:return[4,algHSsign(o)(r,e)];case 2:return[2,u.sent()];case 3:throw new Error(UNSUPPORTED_ALGORITHM)}})})}function jwtVerify(t,r){return __awaiter(this,void 0,void 0,function(){var e,n,i;return __generator(this,function(o){switch(o.label){case 0:return e=jwtSplit(t),n=s2J(bu2s(e.header)),i=e.header+"."+e.payload,[4,algVerify(n.alg,i,e.signature,r)];case 1:return[2,o.sent()]}})})}function jwtSign(t,r){return __awaiter(this,void 0,void 0,function(){var e,n,i;return __generator(this,function(o){switch(o.label){case 0:return e=jwtSplit(t),n=s2J(bu2s(e.header)),i=e.header+"."+e.payload,[4,algSign(n.alg,i,r)];case 1:return[2,o.sent()]}})})}function resignJwt(t,r,e){return __awaiter(this,void 0,void 0,function(){var n,i;return __generator(this,function(o){switch(o.label){case 0:return n=jwtDecode(t),e&&(n.header.alg=e),i=n,[4,jwtSign(n.toString(),r)];case 1:return i.signature=o.sent(),[2,n.toString()]}})})}function cryptoType(){return crypto?crypto.type||"crypto-node":"undefined"}import pako from"pako";import crypto from"crypto";var webCrypto="object"==typeof window&&(window.crypto||window.msCrypto),webCryptoSubtle=webCrypto&&(webCrypto.subtle||webCrypto.webkitSubtle||webCrypto.Subtle),UNSUPPORTED_ALGORITHM='Unsupported algorithm name specified! Supported algorithms: "HS256", "HS384", "HS512", "RS256", "RS384", "RS512" and "none".',ILLEGAL_ARGUMENT="Illegal argument specified!",JwtSplit=function(){function t(t){if("string"!=typeof t)throw new Error(ILLEGAL_ARGUMENT);var r=t.split(".");if(3!==r.length)throw new Error(ILLEGAL_ARGUMENT);var e=r[0],n=r[1],i=r[2];this.header=e,this.payload=n,this.signature=i}return t.prototype.toString=function(){return this.header+"."+this.payload+"."+this.signature},t}(),JwtDecode=function(){function t(t){if(this.header={},this.payload={},this.signature="","string"!=typeof t)throw new Error(ILLEGAL_ARGUMENT);var r=jwtSplit(t);r&&(this.header=r.header?s2J(bu2s(r.header)):{},this.payload=r.payload?s2J(isGzip(this.header)?zbu2s(r.payload):bu2s(r.payload)):{},this.signature=r.signature||"")}return t.prototype.toString=function(){return s2bu(JSON.stringify(this.header))+"."+(isGzip(this.header)?s2zbu(JSON.stringify(this.payload)):s2bu(JSON.stringify(this.payload)))+"."+this.signature},t}();export{webCrypto,webCryptoSubtle,UNSUPPORTED_ALGORITHM,ILLEGAL_ARGUMENT,JwtSplit,JwtDecode,s2J,b2s,b2bu,bu2b,bu2s,isGzip,jwtDecode,jwtSplit,s2b,s2bu,s2zbu,unzip,zbu2s,zip,createHmac,algHSsign,algHSverify,RS2AB,algVerify,algSign,jwtVerify,jwtSign,resignJwt,cryptoType};
